\hypertarget{class_task_share}{}\section{Task\+Share$<$ Data\+Type $>$ Class Template Reference}
\label{class_task_share}\index{Task\+Share$<$ Data\+Type $>$@{Task\+Share$<$ Data\+Type $>$}}


Class for data to be shared in a thread-\/safe manner between tasks.  




{\ttfamily \#include $<$taskshare.\+h$>$}

Inheritance diagram for Task\+Share$<$ Data\+Type $>$\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{class_task_share}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_task_share_a9e49e43c6da3859b9690a62ad64d7f40}{Task\+Share}} (const char $\ast$p\+\_\+name)
\begin{DoxyCompactList}\small\item\em Construct a shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_task_share_ae1cf7a4f95975446adcfa947d9dabf82}{put}} (Data\+Type)
\begin{DoxyCompactList}\small\item\em Put data into the shared data item. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_task_share_a78de768fa4760c6e8f74c7795ff164c7}{I\+S\+R\+\_\+put}} (Data\+Type)
\begin{DoxyCompactList}\small\item\em Put data into the shared data item from within an I\+SR. \end{DoxyCompactList}\item 
Data\+Type \mbox{\hyperlink{class_task_share_a0cf8afd4f4d90c1e91ff2af9a004ecec}{get}} (void)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item. \end{DoxyCompactList}\item 
Data\+Type \mbox{\hyperlink{class_task_share_a5a4bac78053046c248896441a5b3a839}{I\+S\+R\+\_\+get}} (void)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item, from within an I\+SR. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_task_share_a08835a91ed7ccd847cefe6ff72fe22e6}{print\+\_\+in\+\_\+list}} (\mbox{\hyperlink{classemstream}{emstream}} $\ast$p\+\_\+ser\+\_\+dev)
\begin{DoxyCompactList}\small\item\em Read data from the shared data item, from within an I\+SR. \end{DoxyCompactList}\item 
Data\+Type \& \mbox{\hyperlink{class_task_share_a8c3b841652c2cde1bfb279aa5bfcc61f}{operator++}} (void)
\begin{DoxyCompactList}\small\item\em The prefix increment causes the shared data to increase by one. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_task_share_aaea5630111a55f864b7110456983e0fd}\label{class_task_share_aaea5630111a55f864b7110456983e0fd}} 
Data\+Type \mbox{\hyperlink{class_task_share_aaea5630111a55f864b7110456983e0fd}{operator++}} (int)
\begin{DoxyCompactList}\small\item\em The postfix increment causes the shared data to increase by one. \end{DoxyCompactList}\item 
Data\+Type \& \mbox{\hyperlink{class_task_share_a79024a7661f8f48c5d2303a3fe121a32}{operator-\/-\/}} (void)
\begin{DoxyCompactList}\small\item\em The prefix decrement causes the shared data to decrease by one. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_task_share_a55276cb23f2ac2403ad36acf8f3625e3}\label{class_task_share_a55276cb23f2ac2403ad36acf8f3625e3}} 
Data\+Type \mbox{\hyperlink{class_task_share_a55276cb23f2ac2403ad36acf8f3625e3}{operator-\/-\/}} (int)
\begin{DoxyCompactList}\small\item\em The postfix decrement causes the shared data to decrease by one. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_task_share_aa6a83a01a277f67bc5c1a3527b7c3425}\label{class_task_share_aa6a83a01a277f67bc5c1a3527b7c3425}} 
Data\+Type \mbox{\hyperlink{class_task_share_aa6a83a01a277f67bc5c1a3527b7c3425}{the\+\_\+data}}
\begin{DoxyCompactList}\small\item\em Holds the data to be shared. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\subsubsection*{template$<$class Data\+Type$>$\newline
class Task\+Share$<$ Data\+Type $>$}

Class for data to be shared in a thread-\/safe manner between tasks. 

This class implements an item of data which can be shared between tasks without risk of data corruption associated with global variables. Unlike queues, shares do not use a buffer for many data items; there is only a one-\/item buffer in which the most recent value of the data is kept. Shares therefore do not provide the task synchronization or incur the overhead associated with queues.

The data is protected by using critical code sections (see the Free\+R\+T\+OS documentation of {\ttfamily port\+E\+N\+T\+E\+R\+\_\+\+C\+R\+I\+T\+I\+C\+A\+L()} ) so that tasks can\textquotesingle{}t interrupt each other when reading or writing the data is taking place. This prevents data corruption due to thread switching. The C++ template mechanism is used to ensure that only data of the correct type is put into or taken from a shared data item. A {\ttfamily Task\+Share$<$\+Data\+Type$>$} object keeps its own separate copy of the data. This uses some memory, but it is necessary to reliably prevent data corruption; it prevents possible side effects from causing the sender\textquotesingle{}s copy of the data from being inadvertently changed.\hypertarget{index_Usage}{}\subsection{Usage}\label{index_Usage}
The following bits of code show how to set up and use a share to transfer data of type {\ttfamily uint16\+\_\+t} from one hypothetical task called {\ttfamily task\+\_\+A} to another called {\ttfamily task\+\_\+B}.

In the file which contains {\ttfamily \mbox{\hyperlink{main_8cpp_a840291bc02cba5474a4cb46a9b9566fe}{main()}}} we create a pointer to a share and use the {\ttfamily new} operator to create the share itself. The constructor of the {\ttfamily Task\+Share$<$uint16\+\_\+t$>$} class is given the name of the share; the name will be shown on system diagnostic printouts\+: 
\begin{DoxyCode}
\mbox{\hyperlink{class_task_share}{TaskShare<uint16\_t>}}* p\_my\_share;
...
main ()
\{
    ...
    p\_my\_share = \textcolor{keyword}{new} \mbox{\hyperlink{class_task_share}{TaskShare<uint16\_t>}} (\textcolor{stringliteral}{"Data\_3"});
\}
\end{DoxyCode}
 In a header file which is read by all the source files in the project we re-\/declare the share pointer with the keyword {\ttfamily extern} to make it globally accessible in all files that {\ttfamily \#include} this header file\+: 
\begin{DoxyCode}
\textcolor{keyword}{extern} \mbox{\hyperlink{class_task_share}{TaskShare<uint16\_t>}}* p\_my\_share;
\end{DoxyCode}
 In the sending task, data is put into the share\+: 
\begin{DoxyCode}
uint16\_t a\_data\_item;
...
p\_my\_share->put (a\_data\_item);
\end{DoxyCode}
 In the receiving task, data is read from the share\+: 
\begin{DoxyCode}
uint16\_t got\_data;
...
got\_data = p\_my\_share->\mbox{\hyperlink{class_task_share_a0cf8afd4f4d90c1e91ff2af9a004ecec}{get}} ();
\end{DoxyCode}


{\bfseries Note\+:} In the past, M\+E405 students have often used task shares to save data persistently within a task. This is {\bfseries not} necessary. Just use variables declared {\ttfamily static} if the data is only needed within one method. If data needs to be shared between member functions of the same task, make such data member data of the task class rather than local data within one method. This data will persist as long as the owning task object exists, which is generally until the power is turned off. 

\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_task_share_a9e49e43c6da3859b9690a62ad64d7f40}\label{class_task_share_a9e49e43c6da3859b9690a62ad64d7f40}} 
\index{Task\+Share@{Task\+Share}!Task\+Share@{Task\+Share}}
\index{Task\+Share@{Task\+Share}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{Task\+Share()}{TaskShare()}}
{\footnotesize\ttfamily template$<$class Data\+Type$>$ \\
\mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::\mbox{\hyperlink{class_task_share}{Task\+Share}} (\begin{DoxyParamCaption}\item[{const char $\ast$}]{p\+\_\+name }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Construct a shared data item. 

This default constructor for a shared data item doesn\textquotesingle{}t do much besides allocate memory because there isn\textquotesingle{}t any particular setup required. Note that the data is {\bfseries not} initialized. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+name} & A name to be shown in the list of task shares (default {\ttfamily N\+U\+LL}) \\
\hline
\end{DoxyParams}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{class_task_share_a0cf8afd4f4d90c1e91ff2af9a004ecec}\label{class_task_share_a0cf8afd4f4d90c1e91ff2af9a004ecec}} 
\index{Task\+Share@{Task\+Share}!get@{get}}
\index{get@{get}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{get()}{get()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
Data\+Type \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::get (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read data from the shared data item. 

This method is used to read data from the shared data item with critical section protection to ensure that the data cannot be corrupted by a task switch. \begin{DoxyReturn}{Returns}
The current value of the shared data item 
\end{DoxyReturn}
\mbox{\Hypertarget{class_task_share_a5a4bac78053046c248896441a5b3a839}\label{class_task_share_a5a4bac78053046c248896441a5b3a839}} 
\index{Task\+Share@{Task\+Share}!I\+S\+R\+\_\+get@{I\+S\+R\+\_\+get}}
\index{I\+S\+R\+\_\+get@{I\+S\+R\+\_\+get}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{I\+S\+R\+\_\+get()}{ISR\_get()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
Data\+Type \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::I\+S\+R\+\_\+get (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Read data from the shared data item, from within an I\+SR. 

This method is used to enable code within an I\+SR to read data from the shared data item. It must only be called from within an interrupt service routine, not a normal task. This is because critical section protection isn\textquotesingle{}t used here, which is OK, assuming that an interrupt can\textquotesingle{}t be interrupted by another interrupt, which is the case on most small microcontrollers. \begin{DoxyReturn}{Returns}
The current value of the shared data item 
\end{DoxyReturn}
\mbox{\Hypertarget{class_task_share_a78de768fa4760c6e8f74c7795ff164c7}\label{class_task_share_a78de768fa4760c6e8f74c7795ff164c7}} 
\index{Task\+Share@{Task\+Share}!I\+S\+R\+\_\+put@{I\+S\+R\+\_\+put}}
\index{I\+S\+R\+\_\+put@{I\+S\+R\+\_\+put}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{I\+S\+R\+\_\+put()}{ISR\_put()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::I\+S\+R\+\_\+put (\begin{DoxyParamCaption}\item[{Data\+Type}]{new\+\_\+data }\end{DoxyParamCaption})}



Put data into the shared data item from within an I\+SR. 

This method writes data from an I\+SR into the shared data item. It must only be called from within a hardware interrupt, not a normal task. This is because critical section protection isn\textquotesingle{}t used here, which is OK, assuming that an interrupt can\textquotesingle{}t be interrupted by another interrupt, which is the case on most small microcontrollers. 
\begin{DoxyParams}{Parameters}
{\em new\+\_\+data} & The data which is to be written into the shared data item \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{class_task_share_a8c3b841652c2cde1bfb279aa5bfcc61f}\label{class_task_share_a8c3b841652c2cde1bfb279aa5bfcc61f}} 
\index{Task\+Share@{Task\+Share}!operator++@{operator++}}
\index{operator++@{operator++}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{operator++()}{operator++()}}
{\footnotesize\ttfamily template$<$class Data\+Type$>$ \\
Data\+Type\& \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::operator++ (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



The prefix increment causes the shared data to increase by one. 

This operator just increases by one the variable held by the shared data item. B\+UG\+: It should return a reference to this shared data item, but for some reason the compiler insists it must return a reference to the data. Why is unknown. \mbox{\Hypertarget{class_task_share_a79024a7661f8f48c5d2303a3fe121a32}\label{class_task_share_a79024a7661f8f48c5d2303a3fe121a32}} 
\index{Task\+Share@{Task\+Share}!operator-\/-\/@{operator-\/-\/}}
\index{operator-\/-\/@{operator-\/-\/}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{operator-\/-\/()}{operator--()}}
{\footnotesize\ttfamily template$<$class Data\+Type$>$ \\
Data\+Type\& \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::operator-\/-\/ (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



The prefix decrement causes the shared data to decrease by one. 

This operator just decreases by one the variable held by the shared data item. B\+UG\+: It should return a reference to this shared data item, but for some reason the compiler insists it must return a reference to the data. Why is unknown. \mbox{\Hypertarget{class_task_share_a08835a91ed7ccd847cefe6ff72fe22e6}\label{class_task_share_a08835a91ed7ccd847cefe6ff72fe22e6}} 
\index{Task\+Share@{Task\+Share}!print\+\_\+in\+\_\+list@{print\+\_\+in\+\_\+list}}
\index{print\+\_\+in\+\_\+list@{print\+\_\+in\+\_\+list}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{print\+\_\+in\+\_\+list()}{print\_in\_list()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::print\+\_\+in\+\_\+list (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classemstream}{emstream}} $\ast$}]{p\+\_\+ser\+\_\+dev }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Read data from the shared data item, from within an I\+SR. 

This method is used to enable code within an I\+SR to read data from the shared data item. It must only be called from within an interrupt service routine, not a normal task. This is because critical section protection isn\textquotesingle{}t used here, which is OK, assuming that an interrupt can\textquotesingle{}t be interrupted by another interrupt, which is the case on most small microcontrollers. 
\begin{DoxyParams}{Parameters}
{\em p\+\_\+ser\+\_\+dev} & Pointer to a serial device on which to print the status \\
\hline
\end{DoxyParams}


Implements \mbox{\hyperlink{class_base_share_a81ef685c8c1897ee316e853103e9941a}{Base\+Share}}.

\mbox{\Hypertarget{class_task_share_ae1cf7a4f95975446adcfa947d9dabf82}\label{class_task_share_ae1cf7a4f95975446adcfa947d9dabf82}} 
\index{Task\+Share@{Task\+Share}!put@{put}}
\index{put@{put}!Task\+Share@{Task\+Share}}
\subsubsection{\texorpdfstring{put()}{put()}}
{\footnotesize\ttfamily template$<$class Data\+Type $>$ \\
void \mbox{\hyperlink{class_task_share}{Task\+Share}}$<$ Data\+Type $>$\+::put (\begin{DoxyParamCaption}\item[{Data\+Type}]{new\+\_\+data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Put data into the shared data item. 

This method is used to write data into the shared data item. It\textquotesingle{}s declared {\ttfamily inline} so that instead of a regular function call at the assembly language level, {\ttfamily an\+\_\+object.\+put (x);} will result in the code within this function being inserted directly into the calling function. This is faster than doing a regular function call, which involves pushing the program counter on the stack, pushing parameters, jumping, making space for local variables, jumping back and popping the program counter, yawn, zzz... 
\begin{DoxyParams}{Parameters}
{\em new\+\_\+data} & The data which is to be written \\
\hline
\end{DoxyParams}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
Doxygen\+Files/\mbox{\hyperlink{taskshare_8h}{taskshare.\+h}}\end{DoxyCompactItemize}
